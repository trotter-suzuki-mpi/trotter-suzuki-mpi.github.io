<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Massively Parallel Trotter-Suzuki Solver: Examples</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="vortex.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Massively Parallel Trotter-Suzuki Solver
   &#160;<span id="projectnumber">1.5.5</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="md_download.html"><span>Download&#160;and&#160;Installation</span></a></li>
      <li><a href="md_tutorial.html"><span>Tutorial</span></a></li>
      <li><a href="md_examples.html"><span>Examples</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Examples </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The examples below show how to use the C++ API. If you are interested in the Python version, refer to <a href="https://trotter-suzuki-mpi.readthedocs.io">Read the Docs</a>.</p>
<p>Examples of using the API are included in the source tree. The respective files are in the examples folder.</p>
<h2>Time evolution of a particle in a box with an exponential initial state with periodic boundary conditions </h2>
<div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;iomanip&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div><div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div><div class="line"><span class="preprocessor">#include &lt;mpi.h&gt;</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#include &quot;trottersuzuki.h&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define DIM 640</span></div><div class="line"><span class="preprocessor">#define ITERATIONS 1000</span></div><div class="line"><span class="preprocessor">#define KERNEL_TYPE &quot;cpu&quot;</span></div><div class="line"><span class="preprocessor">#define SNAPSHOTS 10</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv) {</div><div class="line">    <span class="keywordtype">double</span> length = double(DIM);</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> particle_mass = 1.;</div><div class="line">    <span class="keywordtype">bool</span> imag_time = <span class="keyword">false</span>;</div><div class="line">    <span class="keywordtype">double</span> delta_t = 5.e-4;</div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div><div class="line">    MPI_Init(&amp;argc, &amp;argv);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    <span class="comment">//set lattice</span></div><div class="line">    <a class="code" href="classLattice.html">Lattice</a> *grid = <span class="keyword">new</span> <a class="code" href="classLattice.html">Lattice</a>(DIM, length, <span class="keyword">true</span>, <span class="keyword">true</span>);</div><div class="line">    <span class="comment">//set initial state</span></div><div class="line">    <a class="code" href="classState.html">State</a> *state = <span class="keyword">new</span> <a class="code" href="classExponentialState.html">ExponentialState</a>(grid, 1, 0);</div><div class="line">    <span class="comment">//set hamiltonian</span></div><div class="line">    <a class="code" href="classHamiltonian.html">Hamiltonian</a> *hamiltonian = <span class="keyword">new</span> <a class="code" href="classHamiltonian.html">Hamiltonian</a>(grid, NULL, particle_mass);</div><div class="line">    <span class="comment">//set evolution</span></div><div class="line">    <a class="code" href="classSolver.html">Solver</a> *solver = <span class="keyword">new</span> <a class="code" href="classSolver.html">Solver</a>(grid, state, hamiltonian, delta_t, KERNEL_TYPE);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span>(grid-&gt;<a class="code" href="classLattice.html#a38f04d58222c67992677fbb9c76ff023">mpi_rank</a> == 0) {</div><div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;\n* This source provides an example of the trotter-suzuki program.\n&quot;</span>;</div><div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;* It calculates the time-evolution of a particle in a box\n&quot;</span>;</div><div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;* with periodic boundary conditions, where the initial\n&quot;</span>;</div><div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;* state is the following:\n&quot;</span>;</div><div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;* \texp(i2M_PI / L (x + y))\n\n&quot;</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">//set file output directory</span></div><div class="line">    stringstream dirname, fileprefix, file_info;</div><div class="line">    dirname &lt;&lt; <span class="stringliteral">&quot;D&quot;</span> &lt;&lt; DIM &lt;&lt; <span class="stringliteral">&quot;_I&quot;</span> &lt;&lt; ITERATIONS &lt;&lt; <span class="stringliteral">&quot;_S&quot;</span> &lt;&lt; SNAPSHOTS &lt;&lt; <span class="stringliteral">&quot;&quot;</span>;</div><div class="line">    mkdir(dirname.str().c_str(), S_IRWXU | S_IRWXG | S_IROTH | S_IXOTH);</div><div class="line">    file_info  &lt;&lt; dirname.str() &lt;&lt; <span class="stringliteral">&quot;/file_info.txt&quot;</span>;</div><div class="line">    ofstream out(file_info.str().c_str());</div><div class="line"></div><div class="line">    <span class="keywordtype">double</span> mean_X, var_X;</div><div class="line">    <span class="keywordtype">double</span> mean_Y, var_Y;</div><div class="line">    <span class="keywordtype">double</span> mean_Px, var_Px;</div><div class="line">    <span class="keywordtype">double</span> mean_Py, var_Py;</div><div class="line"></div><div class="line">    <span class="comment">//get expected values</span></div><div class="line">    <span class="keywordtype">double</span> norm2 = solver-&gt;<a class="code" href="classSolver.html#ac19c0fcf546647fd08c264010b02ee7b">get_squared_norm</a>();</div><div class="line">    <span class="keywordtype">double</span> tot_energy = solver-&gt;<a class="code" href="classSolver.html#aeb5ea40d4c6cba2312f05e839fb1cf8e">get_total_energy</a>();</div><div class="line">    <span class="keywordtype">double</span> kin_energy = solver-&gt;<a class="code" href="classSolver.html#a9ab0c2e624be8dc9e15cd6ebf4c83566">get_kinetic_energy</a>();</div><div class="line"></div><div class="line">    mean_X = state-&gt;<a class="code" href="classState.html#a7998338167ee44f627ffae1ac8ce7011">get_mean_x</a>();</div><div class="line">    var_X = state-&gt;<a class="code" href="classState.html#a7d3409b73a3f2d6a1ae0fc15f7258b50">get_mean_xx</a>() - state-&gt;<a class="code" href="classState.html#a7998338167ee44f627ffae1ac8ce7011">get_mean_x</a>() * state-&gt;<a class="code" href="classState.html#a7998338167ee44f627ffae1ac8ce7011">get_mean_x</a>();</div><div class="line">    mean_Y = state-&gt;<a class="code" href="classState.html#a439626a4522a1216ad16140afd4ca24d">get_mean_y</a>();</div><div class="line">    var_Y = state-&gt;<a class="code" href="classState.html#a0e3fde73b7ba4a46cfede5cb63d23858">get_mean_yy</a>() - state-&gt;<a class="code" href="classState.html#a439626a4522a1216ad16140afd4ca24d">get_mean_y</a>() * state-&gt;<a class="code" href="classState.html#a439626a4522a1216ad16140afd4ca24d">get_mean_y</a>();</div><div class="line">    mean_Px = state-&gt;<a class="code" href="classState.html#ad7e9cca37f7c8260f92fdfcd6b2b31b3">get_mean_px</a>();</div><div class="line">    var_Px = state-&gt;<a class="code" href="classState.html#a8ecfa9af58d99b56d98598ea0c326ce1">get_mean_pxpx</a>() - state-&gt;<a class="code" href="classState.html#ad7e9cca37f7c8260f92fdfcd6b2b31b3">get_mean_px</a>() * state-&gt;<a class="code" href="classState.html#ad7e9cca37f7c8260f92fdfcd6b2b31b3">get_mean_px</a>();</div><div class="line">    mean_Py = state-&gt;<a class="code" href="classState.html#a9929760745da0dfd612d69dceaa6ca7b">get_mean_py</a>();</div><div class="line">    var_Py = state-&gt;<a class="code" href="classState.html#a2eb250225bb18632608909222acbba73">get_mean_pypy</a>() - state-&gt;<a class="code" href="classState.html#a9929760745da0dfd612d69dceaa6ca7b">get_mean_py</a>() * state-&gt;<a class="code" href="classState.html#a9929760745da0dfd612d69dceaa6ca7b">get_mean_py</a>();</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (grid-&gt;<a class="code" href="classLattice.html#a38f04d58222c67992677fbb9c76ff023">mpi_rank</a> == 0){</div><div class="line">      out &lt;&lt; std::setw(11) &lt;&lt; <span class="stringliteral">&quot;time&quot;</span> &lt;&lt; std::setw(14) &lt;&lt; <span class="stringliteral">&quot;squared norm&quot;</span> &lt;&lt; std::setw(14) &lt;&lt; <span class="stringliteral">&quot;tot energy&quot;</span> &lt;&lt; std::setw(14) &lt;&lt; <span class="stringliteral">&quot;kin energy&quot;</span> &lt;&lt; std::setw(14) &lt;&lt; <span class="stringliteral">&quot;pot energy&quot;</span>  &lt;&lt; std::setw(14) &lt;&lt; <span class="stringliteral">&quot;rot energy&quot;</span></div><div class="line">          &lt;&lt; std::setw(14) &lt;&lt; <span class="stringliteral">&quot;&lt;X&gt;&quot;</span> &lt;&lt; std::setw(14) &lt;&lt; <span class="stringliteral">&quot;&lt;(X-&lt;X&gt;)^2&gt;&quot;</span> &lt;&lt; std::setw(14) &lt;&lt; <span class="stringliteral">&quot;&lt;Y&gt;&quot;</span> &lt;&lt; std::setw(14) &lt;&lt; <span class="stringliteral">&quot;&lt;(Y-&lt;Y&gt;)^2&gt;&quot;</span></div><div class="line">          &lt;&lt; std::setw(14) &lt;&lt; <span class="stringliteral">&quot;&lt;Px&gt;&quot;</span> &lt;&lt; std::setw(14) &lt;&lt; <span class="stringliteral">&quot;&lt;(Px-&lt;Px&gt;)^2&gt;&quot;</span> &lt;&lt; std::setw(14) &lt;&lt; <span class="stringliteral">&quot;&lt;Py&gt;&quot;</span> &lt;&lt; std::setw(14) &lt;&lt; <span class="stringliteral">&quot;&lt;(Py-&lt;Py&gt;)^2&gt;\n&quot;</span>;</div><div class="line">      out &lt;&lt; std::setw(11) &lt;&lt; <span class="stringliteral">&quot;0&quot;</span> &lt;&lt; std::setw(14) &lt;&lt; norm2 &lt;&lt; std::setw(14) &lt;&lt; std::setw(14) &lt;&lt; tot_energy &lt;&lt; std::setw(14) &lt;&lt; kin_energy &lt;&lt; std::setw(14) &lt;&lt; solver-&gt;<a class="code" href="classSolver.html#a239147bf2c1b701dd6a20b0923555a45">get_potential_energy</a>() &lt;&lt; std::setw(14) &lt;&lt; solver-&gt;<a class="code" href="classSolver.html#aa19331f93bfbcb5ea74be9a694bf3326">get_rotational_energy</a>() &lt;&lt; std::setw(14)</div><div class="line">          &lt;&lt; mean_X &lt;&lt; std::setw(14) &lt;&lt; var_X &lt;&lt; std::setw(14) &lt;&lt; mean_Y &lt;&lt; std::setw(14) &lt;&lt; var_Y &lt;&lt; std::setw(14)</div><div class="line">          &lt;&lt; mean_Px &lt;&lt; std::setw(14) &lt;&lt; var_Px &lt;&lt; std::setw(14) &lt;&lt; mean_Py &lt;&lt; std::setw(14) &lt;&lt; var_Py &lt;&lt; endl;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">//evolve and stamp the state</span></div><div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> count_snap = 0; count_snap &lt; SNAPSHOTS; count_snap++) {</div><div class="line">        solver-&gt;<a class="code" href="classSolver.html#afef4d30f0fafcdd30e4bbd68ab4b8d18">evolve</a>(ITERATIONS, imag_time);</div><div class="line">        fileprefix.str(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line">        fileprefix &lt;&lt; dirname.str() &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; ITERATIONS * count_snap;</div><div class="line">        state-&gt;<a class="code" href="classState.html#a30ef4054140d4add7904c2e75b879b2d">write_to_file</a>(fileprefix.str());</div><div class="line"></div><div class="line">        <span class="comment">//get expected values</span></div><div class="line">        norm2 = solver-&gt;<a class="code" href="classSolver.html#ac19c0fcf546647fd08c264010b02ee7b">get_squared_norm</a>();</div><div class="line">        tot_energy = solver-&gt;<a class="code" href="classSolver.html#aeb5ea40d4c6cba2312f05e839fb1cf8e">get_total_energy</a>();</div><div class="line">        kin_energy = solver-&gt;<a class="code" href="classSolver.html#a9ab0c2e624be8dc9e15cd6ebf4c83566">get_kinetic_energy</a>();</div><div class="line">        mean_X = state-&gt;<a class="code" href="classState.html#a7998338167ee44f627ffae1ac8ce7011">get_mean_x</a>();</div><div class="line">        var_X = state-&gt;<a class="code" href="classState.html#a7d3409b73a3f2d6a1ae0fc15f7258b50">get_mean_xx</a>() - state-&gt;<a class="code" href="classState.html#a7998338167ee44f627ffae1ac8ce7011">get_mean_x</a>() * state-&gt;<a class="code" href="classState.html#a7998338167ee44f627ffae1ac8ce7011">get_mean_x</a>();</div><div class="line">        mean_Y = state-&gt;<a class="code" href="classState.html#a439626a4522a1216ad16140afd4ca24d">get_mean_y</a>();</div><div class="line">        var_Y = state-&gt;<a class="code" href="classState.html#a0e3fde73b7ba4a46cfede5cb63d23858">get_mean_yy</a>() - state-&gt;<a class="code" href="classState.html#a439626a4522a1216ad16140afd4ca24d">get_mean_y</a>() * state-&gt;<a class="code" href="classState.html#a439626a4522a1216ad16140afd4ca24d">get_mean_y</a>();</div><div class="line">        mean_Px = state-&gt;<a class="code" href="classState.html#ad7e9cca37f7c8260f92fdfcd6b2b31b3">get_mean_px</a>();</div><div class="line">        var_Px = state-&gt;<a class="code" href="classState.html#a8ecfa9af58d99b56d98598ea0c326ce1">get_mean_pxpx</a>() - state-&gt;<a class="code" href="classState.html#ad7e9cca37f7c8260f92fdfcd6b2b31b3">get_mean_px</a>() * state-&gt;<a class="code" href="classState.html#ad7e9cca37f7c8260f92fdfcd6b2b31b3">get_mean_px</a>();</div><div class="line">        mean_Py = state-&gt;<a class="code" href="classState.html#a9929760745da0dfd612d69dceaa6ca7b">get_mean_py</a>();</div><div class="line">        var_Py = state-&gt;<a class="code" href="classState.html#a2eb250225bb18632608909222acbba73">get_mean_pypy</a>() - state-&gt;<a class="code" href="classState.html#a9929760745da0dfd612d69dceaa6ca7b">get_mean_py</a>() * state-&gt;<a class="code" href="classState.html#a9929760745da0dfd612d69dceaa6ca7b">get_mean_py</a>();</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(grid-&gt;<a class="code" href="classLattice.html#a38f04d58222c67992677fbb9c76ff023">mpi_rank</a> == 0){</div><div class="line">            out &lt;&lt; std::setw(11) &lt;&lt; (count_snap + 1) * ITERATIONS * delta_t &lt;&lt; std::setw(14) &lt;&lt; norm2 &lt;&lt; std::setw(14) &lt;&lt; tot_energy &lt;&lt; std::setw(14) &lt;&lt; kin_energy &lt;&lt; std::setw(14) &lt;&lt; solver-&gt;<a class="code" href="classSolver.html#a239147bf2c1b701dd6a20b0923555a45">get_potential_energy</a>() &lt;&lt; std::setw(14) &lt;&lt; solver-&gt;<a class="code" href="classSolver.html#aa19331f93bfbcb5ea74be9a694bf3326">get_rotational_energy</a>() &lt;&lt; std::setw(14) &lt;&lt;</div><div class="line">            mean_X &lt;&lt; std::setw(14) &lt;&lt; var_X &lt;&lt; std::setw(14) &lt;&lt; mean_Y &lt;&lt; std::setw(14) &lt;&lt; var_Y &lt;&lt; std::setw(14) &lt;&lt;</div><div class="line">            mean_Px &lt;&lt; std::setw(14) &lt;&lt; var_Px &lt;&lt; std::setw(14) &lt;&lt; mean_Py &lt;&lt; std::setw(14) &lt;&lt; var_Py &lt;&lt; endl;</div><div class="line">        }</div><div class="line">    }</div><div class="line">    out.close();</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (grid-&gt;<a class="code" href="classLattice.html#a38f04d58222c67992677fbb9c76ff023">mpi_rank</a> == 0) {</div><div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;TROTTER &quot;</span> &lt;&lt; DIM &lt;&lt; <span class="stringliteral">&quot;x&quot;</span> &lt;&lt; DIM &lt;&lt; <span class="stringliteral">&quot; kernel:&quot;</span> &lt;&lt; KERNEL_TYPE &lt;&lt; <span class="stringliteral">&quot; np:&quot;</span> &lt;&lt; grid-&gt;<a class="code" href="classLattice.html#a654f001aa0e2a8c9f416f88d7db90990">mpi_procs</a> &lt;&lt; endl;</div><div class="line">    }</div><div class="line">    <span class="keyword">delete</span> solver;</div><div class="line">    <span class="keyword">delete</span> hamiltonian;</div><div class="line">    <span class="keyword">delete</span> state;</div><div class="line">    <span class="keyword">delete</span> grid;</div><div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div><div class="line">    MPI_Finalize();</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><h2>Imaginary time evolution of an exponential initial state with periodic boundary conditions </h2>
<div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div><div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div><div class="line"><span class="preprocessor">#include &lt;mpi.h&gt;</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#include &quot;trottersuzuki.h&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define DIM 640</span></div><div class="line"><span class="preprocessor">#define ITERATIONS 1000</span></div><div class="line"><span class="preprocessor">#define KERNEL_TYPE &quot;cpu&quot;</span></div><div class="line"><span class="preprocessor">#define SNAPSHOTS 10</span></div><div class="line"></div><div class="line">complex&lt;double&gt; super_position_two_exp_state(<span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y) {</div><div class="line">    <span class="keywordtype">double</span> L_x = double(DIM);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> exp(complex&lt;double&gt;(0. , 2.*M_PI/L_x*x)) +</div><div class="line">           exp(complex&lt;double&gt;(0. , 10.*2.*M_PI/L_x*x));</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv) {</div><div class="line">    <span class="keywordtype">bool</span> verbose = <span class="keyword">true</span>;</div><div class="line">    <span class="keywordtype">double</span> length = double(DIM);</div><div class="line">    <span class="keywordtype">double</span> delta_t = 0.08;</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> particle_mass = 1.;</div><div class="line">    <span class="keywordtype">bool</span> imag_time = <span class="keyword">true</span>;</div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div><div class="line">    MPI_Init(&amp;argc, &amp;argv);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">    <span class="comment">//set lattice</span></div><div class="line">    <a class="code" href="classLattice.html">Lattice</a> *grid = <span class="keyword">new</span> <a class="code" href="classLattice.html">Lattice</a>(DIM, length, <span class="keyword">true</span>, <span class="keyword">true</span>);</div><div class="line">    <span class="comment">//set initial state</span></div><div class="line">    <a class="code" href="classState.html">State</a> *state = <span class="keyword">new</span> <a class="code" href="classState.html">State</a>(grid);</div><div class="line">    state-&gt;<a class="code" href="classState.html#ae657c1127bda113649b4295949958494">init_state</a>(super_position_two_exp_state);</div><div class="line">    <span class="comment">//set hamiltonian</span></div><div class="line">    <a class="code" href="classHamiltonian.html">Hamiltonian</a> *hamiltonian = <span class="keyword">new</span> <a class="code" href="classHamiltonian.html">Hamiltonian</a>(grid, NULL, particle_mass);</div><div class="line">    <span class="comment">//set evolution</span></div><div class="line">    <a class="code" href="classSolver.html">Solver</a> *solver = <span class="keyword">new</span> <a class="code" href="classSolver.html">Solver</a>(grid, state, hamiltonian, delta_t, KERNEL_TYPE);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span>(grid-&gt;<a class="code" href="classLattice.html#a38f04d58222c67992677fbb9c76ff023">mpi_rank</a> == 0) {</div><div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;\n* This source provides an example of the trotter-suzuki program.\n&quot;</span>;</div><div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;* It calculates the imaginary time-evolution of a free particle in a box\n&quot;</span>;</div><div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;* with periodic boundary conditions, where the initial\n&quot;</span>;</div><div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;* state is the following:\n&quot;</span>;</div><div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;* \texp(i2M_PI / L * x) + exp(i20M_PI / L * x)\n\n&quot;</span>;</div><div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;* The state will reach the eigenfunction of the Hamiltonian with the lowest\n&quot;</span>;</div><div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;* eigenvalue:   exp(i2M_PI / L * x)\n\n&quot;</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">//set file output directory</span></div><div class="line">    stringstream dirname, fileprefix;</div><div class="line">    dirname &lt;&lt; <span class="stringliteral">&quot;D&quot;</span> &lt;&lt; DIM &lt;&lt; <span class="stringliteral">&quot;_I&quot;</span> &lt;&lt; ITERATIONS &lt;&lt; <span class="stringliteral">&quot;_S&quot;</span> &lt;&lt; SNAPSHOTS &lt;&lt; <span class="stringliteral">&quot;&quot;</span>;</div><div class="line">    mkdir(dirname.str().c_str(), S_IRWXU | S_IRWXG | S_IROTH | S_IXOTH);</div><div class="line">    <span class="comment">//evolve and stamp the state</span></div><div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> count_snap = 0; count_snap &lt; SNAPSHOTS; count_snap++) {</div><div class="line">        solver-&gt;<a class="code" href="classSolver.html#afef4d30f0fafcdd30e4bbd68ab4b8d18">evolve</a>(ITERATIONS, imag_time);</div><div class="line">        fileprefix.str(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line">        fileprefix &lt;&lt; dirname.str() &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; 1 &lt;&lt; <span class="stringliteral">&quot;-&quot;</span> &lt;&lt; ITERATIONS * count_snap;</div><div class="line">        state-&gt;<a class="code" href="classState.html#a30ef4054140d4add7904c2e75b879b2d">write_to_file</a>(fileprefix.str());</div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> (grid-&gt;<a class="code" href="classLattice.html#a38f04d58222c67992677fbb9c76ff023">mpi_rank</a> == 0 &amp;&amp; verbose == <span class="keyword">true</span>) {</div><div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;TROTTER &quot;</span> &lt;&lt; DIM &lt;&lt; <span class="stringliteral">&quot;x&quot;</span> &lt;&lt; DIM &lt;&lt; <span class="stringliteral">&quot; kernel:&quot;</span> &lt;&lt; KERNEL_TYPE &lt;&lt; <span class="stringliteral">&quot; np:&quot;</span> &lt;&lt; grid-&gt;<a class="code" href="classLattice.html#a654f001aa0e2a8c9f416f88d7db90990">mpi_procs</a> &lt;&lt; endl;</div><div class="line">    }</div><div class="line">    <span class="keyword">delete</span> solver;</div><div class="line">    <span class="keyword">delete</span> hamiltonian;</div><div class="line">    <span class="keyword">delete</span> state;</div><div class="line">    <span class="keyword">delete</span> grid;</div><div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div><div class="line">    MPI_Finalize();</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><h2>Imaginary time evolution of a Bose-Einstein Condensate trapped in a harmonic potential </h2>
<div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div><div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div><div class="line"><span class="preprocessor">#include &lt;mpi.h&gt;</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#include &quot;trottersuzuki.h&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define LENGTH 30</span></div><div class="line"><span class="preprocessor">#define DIM 640</span></div><div class="line"><span class="preprocessor">#define ITERATIONS 1000</span></div><div class="line"><span class="preprocessor">#define PARTICLES_NUM 1700000</span></div><div class="line"><span class="preprocessor">#define KERNEL_TYPE &quot;cpu&quot;</span></div><div class="line"><span class="preprocessor">#define SNAPSHOTS 10</span></div><div class="line"><span class="preprocessor">#define SCATTER_LENGTH_2D 5.662739242e-5</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv) {</div><div class="line">    <span class="keywordtype">bool</span> verbose = <span class="keyword">true</span>;</div><div class="line">    <span class="keywordtype">bool</span> imag_time = <span class="keyword">true</span>;</div><div class="line">    <span class="keywordtype">double</span> delta_t = 1.e-5;</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> particle_mass = 1.;</div><div class="line">    <span class="keywordtype">double</span> coupling_a = 4. * M_PI * double(SCATTER_LENGTH_2D);</div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div><div class="line">    MPI_Init(&amp;argc, &amp;argv);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">    <span class="comment">//set lattice</span></div><div class="line">    <a class="code" href="classLattice.html">Lattice</a> *grid = <span class="keyword">new</span> <a class="code" href="classLattice.html">Lattice</a>(DIM, (<span class="keywordtype">double</span>)LENGTH);</div><div class="line">    <span class="comment">//set initial state</span></div><div class="line">    <a class="code" href="classState.html">State</a> *state = <span class="keyword">new</span> <a class="code" href="classGaussianState.html">GaussianState</a>(grid, 1., 0., 0., PARTICLES_NUM);</div><div class="line">    <span class="comment">//set hamiltonian</span></div><div class="line">    <a class="code" href="classPotential.html">Potential</a> *potential = <span class="keyword">new</span> <a class="code" href="classHarmonicPotential.html">HarmonicPotential</a>(grid, 1., sqrt(2));</div><div class="line">    <a class="code" href="classHamiltonian.html">Hamiltonian</a> *hamiltonian = <span class="keyword">new</span> <a class="code" href="classHamiltonian.html">Hamiltonian</a>(grid, potential, particle_mass, coupling_a);</div><div class="line">    <span class="comment">//set solver</span></div><div class="line">    <a class="code" href="classSolver.html">Solver</a> *solver = <span class="keyword">new</span> <a class="code" href="classSolver.html">Solver</a>(grid, state, hamiltonian, delta_t, KERNEL_TYPE);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span>(grid-&gt;<a class="code" href="classLattice.html#a38f04d58222c67992677fbb9c76ff023">mpi_rank</a> == 0) {</div><div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;\n* This source provides an example of the trotter-suzuki program.\n&quot;</span>;</div><div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;* It calculates the ground state of a BEC trapped in a harmonic potential.\n&quot;</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">//set file output directory</span></div><div class="line">    stringstream dirname, fileprefix;</div><div class="line">    dirname &lt;&lt; <span class="stringliteral">&quot;D&quot;</span> &lt;&lt; DIM &lt;&lt; <span class="stringliteral">&quot;_I&quot;</span> &lt;&lt; ITERATIONS &lt;&lt; <span class="stringliteral">&quot;_S&quot;</span> &lt;&lt; SNAPSHOTS &lt;&lt; <span class="stringliteral">&quot;&quot;</span>;</div><div class="line">    mkdir(dirname.str().c_str(), S_IRWXU | S_IRWXG | S_IROTH | S_IXOTH);</div><div class="line"></div><div class="line">    fileprefix.str(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line">    fileprefix &lt;&lt; dirname.str() &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; 0;</div><div class="line">    state-&gt;<a class="code" href="classState.html#a30ef4054140d4add7904c2e75b879b2d">write_to_file</a>(fileprefix.str());</div><div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> count_snap = 0; count_snap &lt; SNAPSHOTS; count_snap++) {</div><div class="line">        solver-&gt;<a class="code" href="classSolver.html#afef4d30f0fafcdd30e4bbd68ab4b8d18">evolve</a>(ITERATIONS, imag_time);</div><div class="line">        fileprefix.str(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line">        fileprefix &lt;&lt; dirname.str() &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; ITERATIONS * (count_snap + 1);</div><div class="line">        state-&gt;<a class="code" href="classState.html#a30ef4054140d4add7904c2e75b879b2d">write_to_file</a>(fileprefix.str());</div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> (grid-&gt;<a class="code" href="classLattice.html#a38f04d58222c67992677fbb9c76ff023">mpi_rank</a> == 0 &amp;&amp; verbose == <span class="keyword">true</span>) {</div><div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;TROTTER &quot;</span> &lt;&lt; DIM &lt;&lt; <span class="stringliteral">&quot;x&quot;</span> &lt;&lt; DIM &lt;&lt; <span class="stringliteral">&quot; kernel:&quot;</span> &lt;&lt; KERNEL_TYPE &lt;&lt; <span class="stringliteral">&quot; np:&quot;</span> &lt;&lt; grid-&gt;<a class="code" href="classLattice.html#a654f001aa0e2a8c9f416f88d7db90990">mpi_procs</a> &lt;&lt; endl;</div><div class="line">    }</div><div class="line">    <span class="keyword">delete</span> solver;</div><div class="line">    <span class="keyword">delete</span> hamiltonian;</div><div class="line">    <span class="keyword">delete</span> potential;</div><div class="line">    <span class="keyword">delete</span> state;</div><div class="line">    <span class="keyword">delete</span> grid;</div><div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div><div class="line">    MPI_Finalize();</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><h2>Imaginary time evolution of a Bose-Einstein Condensate with vortexes </h2>
<div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div><div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div><div class="line"><span class="preprocessor">#include &lt;mpi.h&gt;</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#include &quot;trottersuzuki.h&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define LENGTH 25</span></div><div class="line"><span class="preprocessor">#define DIM 200</span></div><div class="line"><span class="preprocessor">#define ITERATIONS 100</span></div><div class="line"><span class="preprocessor">#define PARTICLES_NUM 1.e+6</span></div><div class="line"><span class="preprocessor">#define KERNEL_TYPE &quot;cpu&quot;</span></div><div class="line"><span class="preprocessor">#define SNAPSHOTS 60</span></div><div class="line"><span class="preprocessor">#define SNAP_PER_STAMP 3</span></div><div class="line"><span class="preprocessor">#define COUPLING_CONST_2D 7.116007999594e-4</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv) {</div><div class="line">    <span class="keywordtype">double</span> angular_velocity = 0.9;</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> particle_mass = 1.;</div><div class="line">    <span class="keywordtype">bool</span> imag_time = <span class="keyword">true</span>;</div><div class="line">    <span class="keywordtype">double</span> delta_t = 2.e-4;</div><div class="line">    <span class="keywordtype">double</span> length = double(LENGTH);</div><div class="line">    <span class="keywordtype">double</span> coupling_const = double(COUPLING_CONST_2D);</div><div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div><div class="line">    MPI_Init(&amp;argc, &amp;argv);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">    <span class="comment">//set lattice</span></div><div class="line">    <a class="code" href="classLattice.html">Lattice</a> *grid = <span class="keyword">new</span> <a class="code" href="classLattice.html">Lattice</a>(DIM, length, <span class="keyword">false</span>, <span class="keyword">false</span>, angular_velocity);</div><div class="line">    <span class="comment">//set initial state</span></div><div class="line">    <a class="code" href="classState.html">State</a> *state = <span class="keyword">new</span> <a class="code" href="classGaussianState.html">GaussianState</a>(grid, 0.2, 0., 0., PARTICLES_NUM);</div><div class="line">    <span class="comment">//set hamiltonian</span></div><div class="line">    <a class="code" href="classPotential.html">Potential</a> *potential = <span class="keyword">new</span> <a class="code" href="classHarmonicPotential.html">HarmonicPotential</a>(grid, 1., 1.);</div><div class="line">    <a class="code" href="classHamiltonian.html">Hamiltonian</a> *hamiltonian = <span class="keyword">new</span> <a class="code" href="classHamiltonian.html">Hamiltonian</a>(grid, potential, particle_mass, coupling_const, angular_velocity);</div><div class="line">    <span class="comment">//set evolution</span></div><div class="line">    <a class="code" href="classSolver.html">Solver</a> *solver = <span class="keyword">new</span> <a class="code" href="classSolver.html">Solver</a>(grid, state, hamiltonian, delta_t, KERNEL_TYPE);</div><div class="line"></div><div class="line">    <span class="comment">//set file output directory</span></div><div class="line">    stringstream fileprefix;</div><div class="line">    <span class="keywordtype">string</span> dirname = <span class="stringliteral">&quot;vortexesdir&quot;</span>;</div><div class="line">    mkdir(dirname.c_str(), S_IRWXU | S_IRWXG | S_IROTH | S_IXOTH);</div><div class="line"></div><div class="line">    fileprefix &lt;&lt; dirname &lt;&lt; <span class="stringliteral">&quot;/file_info.txt&quot;</span>;</div><div class="line">    ofstream out(fileprefix.str().c_str());</div><div class="line"></div><div class="line">    <span class="keywordtype">double</span> norm2 = state-&gt;<a class="code" href="classState.html#ab6fa535c87cbe175354448b9fade65d9">get_squared_norm</a>();</div><div class="line">    <span class="keywordtype">double</span> rot_energy = solver-&gt;<a class="code" href="classSolver.html#aa19331f93bfbcb5ea74be9a694bf3326">get_rotational_energy</a>();</div><div class="line">    <span class="keywordtype">double</span> tot_energy = solver-&gt;<a class="code" href="classSolver.html#aeb5ea40d4c6cba2312f05e839fb1cf8e">get_total_energy</a>();</div><div class="line">    <span class="keywordtype">double</span> kin_energy = solver-&gt;<a class="code" href="classSolver.html#a9ab0c2e624be8dc9e15cd6ebf4c83566">get_kinetic_energy</a>();</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span>(grid-&gt;<a class="code" href="classLattice.html#a38f04d58222c67992677fbb9c76ff023">mpi_rank</a> == 0){</div><div class="line">      out &lt;&lt; <span class="stringliteral">&quot;iterations \t rotation energy \t kin energy \t total energy \t norm2\n&quot;</span>;</div><div class="line">      out &lt;&lt; <span class="stringliteral">&quot;0\t&quot;</span> &lt;&lt; rot_energy &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; kin_energy &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; tot_energy &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; norm2 &lt;&lt; endl;</div><div class="line">    }</div><div class="line"></div><div class="line">    fileprefix.str(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line">    fileprefix &lt;&lt; dirname &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; 0;</div><div class="line">    state-&gt;<a class="code" href="classState.html#a27f7fee2862e69626961721c8b99f6b8">write_particle_density</a>(fileprefix.str());</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> count_snap = 0; count_snap &lt; SNAPSHOTS; count_snap++) {</div><div class="line">        solver-&gt;<a class="code" href="classSolver.html#afef4d30f0fafcdd30e4bbd68ab4b8d18">evolve</a>(ITERATIONS, imag_time);</div><div class="line"></div><div class="line">        norm2 = state-&gt;<a class="code" href="classState.html#ab6fa535c87cbe175354448b9fade65d9">get_squared_norm</a>();</div><div class="line">        rot_energy = solver-&gt;<a class="code" href="classSolver.html#aa19331f93bfbcb5ea74be9a694bf3326">get_rotational_energy</a>();</div><div class="line">        tot_energy = solver-&gt;<a class="code" href="classSolver.html#aeb5ea40d4c6cba2312f05e839fb1cf8e">get_total_energy</a>();</div><div class="line">        kin_energy = solver-&gt;<a class="code" href="classSolver.html#a9ab0c2e624be8dc9e15cd6ebf4c83566">get_kinetic_energy</a>();</div><div class="line">        <span class="keywordflow">if</span> (grid-&gt;<a class="code" href="classLattice.html#a38f04d58222c67992677fbb9c76ff023">mpi_rank</a> == 0){</div><div class="line">            out &lt;&lt; (count_snap + 1) * ITERATIONS &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; rot_energy &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; kin_energy &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; tot_energy &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; norm2 &lt;&lt; endl;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">//stamp phase and particles density</span></div><div class="line">        <span class="keywordflow">if</span>(count_snap % SNAP_PER_STAMP == 0.) {</div><div class="line">            <span class="comment">//get and stamp phase</span></div><div class="line">            fileprefix.str(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line">            fileprefix &lt;&lt; dirname &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; ITERATIONS * (count_snap + 1);</div><div class="line">            state-&gt;<a class="code" href="classState.html#a53650338770697ddfc73ff4db8f4a55f">write_phase</a>(fileprefix.str());</div><div class="line">            <span class="comment">//get and stamp particles density</span></div><div class="line">            state-&gt;<a class="code" href="classState.html#a27f7fee2862e69626961721c8b99f6b8">write_particle_density</a>(fileprefix.str());</div><div class="line">        }</div><div class="line">    }</div><div class="line">    out.close();</div><div class="line">    fileprefix.str(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line">    fileprefix &lt;&lt; dirname &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; 1 &lt;&lt; <span class="stringliteral">&quot;-&quot;</span> &lt;&lt; ITERATIONS * SNAPSHOTS;</div><div class="line">    state-&gt;<a class="code" href="classState.html#a30ef4054140d4add7904c2e75b879b2d">write_to_file</a>(fileprefix.str());</div><div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">    <span class="keyword">delete</span> solver;</div><div class="line">    <span class="keyword">delete</span> hamiltonian;</div><div class="line">    <span class="keyword">delete</span> potential;</div><div class="line">    <span class="keyword">delete</span> state;</div><div class="line">    <span class="keyword">delete</span> grid;</div><div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div><div class="line">    MPI_Finalize();</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><h2>Time evolution of a two-component Bose-Einstein Condensate trapped in a harmonic potential </h2>
<div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;iomanip&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;trottersuzuki.h&quot;</span></div><div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div><div class="line"><span class="preprocessor">#include &lt;mpi.h&gt;</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define LENGTH 10</span></div><div class="line"><span class="preprocessor">#define DIM 50</span></div><div class="line"><span class="preprocessor">#define ITERATIONS 1</span></div><div class="line"><span class="preprocessor">#define PARTICLES_NUM 1700000</span></div><div class="line"><span class="preprocessor">#define KERNEL_TYPE &quot;cpu&quot;</span></div><div class="line"><span class="preprocessor">#define SNAPSHOTS 1</span></div><div class="line"><span class="preprocessor">#define SNAP_PER_STAMP 5</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv) {</div><div class="line">    <span class="keywordtype">double</span> particle_mass_a = 1., particle_mass_b = 1.;</div><div class="line">    <span class="keywordtype">bool</span> imag_time = <span class="keyword">false</span>;</div><div class="line">    <span class="keywordtype">double</span> delta_t = 1.e-3;</div><div class="line">    <span class="keywordtype">double</span> length = double(LENGTH);</div><div class="line">    <span class="keywordtype">double</span> coupling_a = 0;<span class="comment">//7.116007999594e-4;</span></div><div class="line">    <span class="keywordtype">double</span> coupling_b = 0;<span class="comment">//7.116007999594e-4;</span></div><div class="line">    <span class="keywordtype">double</span> coupling_ab = 0;</div><div class="line">    <span class="keywordtype">double</span> omega_i = 0.;</div><div class="line">    <span class="keywordtype">double</span> omega_r = 2.*M_PI/20.;</div><div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div><div class="line">    MPI_Init(&amp;argc, &amp;argv);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    <span class="comment">//set lattice</span></div><div class="line">    <a class="code" href="classLattice.html">Lattice</a> *grid = <span class="keyword">new</span> <a class="code" href="classLattice.html">Lattice</a>(DIM, length);</div><div class="line">    <span class="comment">//set initial state</span></div><div class="line">    <a class="code" href="classState.html">State</a> *state1 = <span class="keyword">new</span> <a class="code" href="classGaussianState.html">GaussianState</a>(grid, 1, 0., 0., PARTICLES_NUM);</div><div class="line">    <a class="code" href="classState.html">State</a> *state2 = <span class="keyword">new</span> <a class="code" href="classGaussianState.html">GaussianState</a>(grid, 1, 0., 0., PARTICLES_NUM, M_PI/2.);</div><div class="line"></div><div class="line">    <span class="comment">//set hamiltonian</span></div><div class="line">    <a class="code" href="classPotential.html">Potential</a> *potential = <span class="keyword">new</span> <a class="code" href="classHarmonicPotential.html">HarmonicPotential</a>(grid, 1., 1.);</div><div class="line">    <a class="code" href="classHamiltonian2Component.html">Hamiltonian2Component</a> *hamiltonian = <span class="keyword">new</span> <a class="code" href="classHamiltonian2Component.html">Hamiltonian2Component</a>(grid, potential, potential, particle_mass_a, particle_mass_b, coupling_a, coupling_ab, coupling_b, omega_r, omega_i);</div><div class="line"></div><div class="line">    <span class="comment">//set evolution</span></div><div class="line">    <a class="code" href="classSolver.html">Solver</a> *solver = <span class="keyword">new</span> <a class="code" href="classSolver.html">Solver</a>(grid, state1, state2, hamiltonian, delta_t, KERNEL_TYPE);</div><div class="line"></div><div class="line">    <span class="comment">//set file output directory</span></div><div class="line">    stringstream fileprefix;</div><div class="line">    <span class="keywordtype">string</span> dirname = <span class="stringliteral">&quot;coupledGPE&quot;</span>;</div><div class="line">    mkdir(dirname.c_str(), S_IRWXU | S_IRWXG | S_IROTH | S_IXOTH);</div><div class="line"></div><div class="line">    fileprefix &lt;&lt; dirname &lt;&lt; <span class="stringliteral">&quot;/file_info.txt&quot;</span>;</div><div class="line">    ofstream out(fileprefix.str().c_str());</div><div class="line"></div><div class="line">    <span class="keywordtype">double</span> norm2[2];</div><div class="line">    norm2[0] = state1-&gt;<a class="code" href="classState.html#ab6fa535c87cbe175354448b9fade65d9">get_squared_norm</a>();</div><div class="line">    norm2[1] = state2-&gt;<a class="code" href="classState.html#ab6fa535c87cbe175354448b9fade65d9">get_squared_norm</a>();</div><div class="line">    <span class="comment">//get expected values</span></div><div class="line">    <span class="keywordtype">double</span> tot_energy = solver-&gt;<a class="code" href="classSolver.html#aeb5ea40d4c6cba2312f05e839fb1cf8e">get_total_energy</a>();</div><div class="line">    <span class="keywordtype">double</span> kin_energy = solver-&gt;<a class="code" href="classSolver.html#a9ab0c2e624be8dc9e15cd6ebf4c83566">get_kinetic_energy</a>();</div><div class="line">    <span class="keywordtype">double</span> rabi_energy = solver-&gt;<a class="code" href="classSolver.html#a5be4020d6a7a57a9ef897bf5488aee28">get_rabi_energy</a>();</div><div class="line">    <span class="keywordtype">double</span> pot_energy = solver-&gt;<a class="code" href="classSolver.html#a239147bf2c1b701dd6a20b0923555a45">get_potential_energy</a>();</div><div class="line">    <span class="keywordtype">double</span> intra_energy = solver-&gt;<a class="code" href="classSolver.html#a6b6d5a32556689250db6c7ee2eddacdf">get_intra_species_energy</a>();</div><div class="line">    <span class="keywordtype">double</span> inter_energy = solver-&gt;<a class="code" href="classSolver.html#acd920bc05bddaff2ebe80b25c3ee5f5b">get_inter_species_energy</a>();</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (grid-&gt;<a class="code" href="classLattice.html#a38f04d58222c67992677fbb9c76ff023">mpi_rank</a> == 0){</div><div class="line">      out &lt;&lt; std::setw(11) &lt;&lt; <span class="stringliteral">&quot;time&quot;</span> &lt;&lt; std::setw(14) &lt;&lt; <span class="stringliteral">&quot;squared norm&quot;</span> &lt;&lt; std::setw(14) &lt;&lt; <span class="stringliteral">&quot;sq norm1&quot;</span> &lt;&lt; std::setw(14) &lt;&lt; <span class="stringliteral">&quot;sq norm2&quot;</span> &lt;&lt; std::setw(14) &lt;&lt; <span class="stringliteral">&quot;tot energy&quot;</span> &lt;&lt; std::setw(14)</div><div class="line">          &lt;&lt; <span class="stringliteral">&quot;kin energy&quot;</span> &lt;&lt; std::setw(14) &lt;&lt; <span class="stringliteral">&quot;pot energy&quot;</span> &lt;&lt; std::setw(14) &lt;&lt; <span class="stringliteral">&quot;intra energy&quot;</span> &lt;&lt; std::setw(14) &lt;&lt; <span class="stringliteral">&quot;inter energy&quot;</span>  &lt;&lt; std::setw(14) &lt;&lt; <span class="stringliteral">&quot;rabi energy\n&quot;</span>;</div><div class="line">      out &lt;&lt; std::setw(11) &lt;&lt; <span class="stringliteral">&quot;0&quot;</span> &lt;&lt; std::setw(14) &lt;&lt; norm2[0] + norm2[1] &lt;&lt; std::setw(14) &lt;&lt; norm2[0] &lt;&lt; std::setw(14) &lt;&lt; norm2[1] &lt;&lt; std::setw(14) &lt;&lt; tot_energy &lt;&lt; std::setw(14)</div><div class="line">          &lt;&lt; kin_energy &lt;&lt; std::setw(14) &lt;&lt; pot_energy &lt;&lt; std::setw(14) &lt;&lt; intra_energy &lt;&lt; std::setw(14) &lt;&lt; inter_energy &lt;&lt; std::setw(14) &lt;&lt; rabi_energy &lt;&lt; endl;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">//write phase and density</span></div><div class="line">    fileprefix.str(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line">    fileprefix &lt;&lt; dirname &lt;&lt; <span class="stringliteral">&quot;/1-&quot;</span> &lt;&lt; 0;</div><div class="line">    state1-&gt;<a class="code" href="classState.html#a53650338770697ddfc73ff4db8f4a55f">write_phase</a>(fileprefix.str());</div><div class="line">    state1-&gt;<a class="code" href="classState.html#a27f7fee2862e69626961721c8b99f6b8">write_particle_density</a>(fileprefix.str());</div><div class="line">    fileprefix.str(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line">    fileprefix &lt;&lt; dirname &lt;&lt; <span class="stringliteral">&quot;/2-&quot;</span> &lt;&lt; 0;</div><div class="line">    state2-&gt;<a class="code" href="classState.html#a53650338770697ddfc73ff4db8f4a55f">write_phase</a>(fileprefix.str());</div><div class="line">    state2-&gt;<a class="code" href="classState.html#a27f7fee2862e69626961721c8b99f6b8">write_particle_density</a>(fileprefix.str());</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> count_snap = 0; count_snap &lt; SNAPSHOTS; count_snap++) {</div><div class="line">        solver-&gt;<a class="code" href="classSolver.html#afef4d30f0fafcdd30e4bbd68ab4b8d18">evolve</a>(ITERATIONS, imag_time);</div><div class="line">        <span class="comment">//norm calculation</span></div><div class="line">        norm2[0] = state1-&gt;<a class="code" href="classState.html#ab6fa535c87cbe175354448b9fade65d9">get_squared_norm</a>();</div><div class="line">        norm2[1] = state2-&gt;<a class="code" href="classState.html#ab6fa535c87cbe175354448b9fade65d9">get_squared_norm</a>();</div><div class="line">        <span class="comment">//get expected values</span></div><div class="line">        tot_energy = solver-&gt;<a class="code" href="classSolver.html#aeb5ea40d4c6cba2312f05e839fb1cf8e">get_total_energy</a>();</div><div class="line">        kin_energy = solver-&gt;<a class="code" href="classSolver.html#a9ab0c2e624be8dc9e15cd6ebf4c83566">get_kinetic_energy</a>();</div><div class="line">        rabi_energy = solver-&gt;<a class="code" href="classSolver.html#a5be4020d6a7a57a9ef897bf5488aee28">get_rabi_energy</a>();</div><div class="line">        pot_energy = solver-&gt;<a class="code" href="classSolver.html#a239147bf2c1b701dd6a20b0923555a45">get_potential_energy</a>();</div><div class="line">        intra_energy = solver-&gt;<a class="code" href="classSolver.html#a6b6d5a32556689250db6c7ee2eddacdf">get_intra_species_energy</a>();</div><div class="line">        inter_energy = solver-&gt;<a class="code" href="classSolver.html#acd920bc05bddaff2ebe80b25c3ee5f5b">get_inter_species_energy</a>();</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(grid-&gt;<a class="code" href="classLattice.html#a38f04d58222c67992677fbb9c76ff023">mpi_rank</a> == 0){</div><div class="line">            out &lt;&lt; std::setw(11) &lt;&lt; (count_snap + 1) * ITERATIONS * delta_t &lt;&lt; std::setw(14) &lt;&lt; norm2[0] + norm2[1] &lt;&lt; std::setw(14) &lt;&lt; norm2[0] &lt;&lt; std::setw(14) &lt;&lt; norm2[1] &lt;&lt; std::setw(14) &lt;&lt; tot_energy &lt;&lt; std::setw(14)</div><div class="line">                &lt;&lt; kin_energy &lt;&lt; std::setw(14) &lt;&lt; pot_energy &lt;&lt; std::setw(14) &lt;&lt; intra_energy &lt;&lt; std::setw(14) &lt;&lt; inter_energy &lt;&lt; std::setw(14) &lt;&lt; rabi_energy &lt;&lt; endl;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">//stamp phase and particles density</span></div><div class="line">        <span class="keywordflow">if</span>(count_snap % SNAP_PER_STAMP == 0.) {</div><div class="line">            <span class="comment">//write phase and density</span></div><div class="line">            fileprefix.str(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line">            fileprefix &lt;&lt; dirname &lt;&lt; <span class="stringliteral">&quot;/1-&quot;</span> &lt;&lt; ITERATIONS * (count_snap + 1);</div><div class="line">            state1-&gt;<a class="code" href="classState.html#a53650338770697ddfc73ff4db8f4a55f">write_phase</a>(fileprefix.str());</div><div class="line">            state1-&gt;<a class="code" href="classState.html#a27f7fee2862e69626961721c8b99f6b8">write_particle_density</a>(fileprefix.str());</div><div class="line">            fileprefix.str(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line">            fileprefix &lt;&lt; dirname &lt;&lt; <span class="stringliteral">&quot;/2-&quot;</span> &lt;&lt; ITERATIONS * (count_snap + 1);</div><div class="line">            state2-&gt;<a class="code" href="classState.html#a53650338770697ddfc73ff4db8f4a55f">write_phase</a>(fileprefix.str());</div><div class="line">            state2-&gt;<a class="code" href="classState.html#a27f7fee2862e69626961721c8b99f6b8">write_particle_density</a>(fileprefix.str());</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    out.close();</div><div class="line">    fileprefix.str(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line">    fileprefix &lt;&lt; dirname &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; 1 &lt;&lt; <span class="stringliteral">&quot;-&quot;</span> &lt;&lt; ITERATIONS * SNAPSHOTS;</div><div class="line">    state1-&gt;<a class="code" href="classState.html#a30ef4054140d4add7904c2e75b879b2d">write_to_file</a>(fileprefix.str());</div><div class="line">    <span class="keyword">delete</span> solver;</div><div class="line">    <span class="keyword">delete</span> hamiltonian;</div><div class="line">    <span class="keyword">delete</span> potential;</div><div class="line">    <span class="keyword">delete</span> state1;</div><div class="line">    <span class="keyword">delete</span> state2;</div><div class="line">    <span class="keyword">delete</span> grid;</div><div class="line"><span class="preprocessor">#ifdef HAVE_MPI</span></div><div class="line">    MPI_Finalize();</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
